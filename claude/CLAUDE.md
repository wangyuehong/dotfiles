# Claude Code 用户级规则

## 语言交流规则
- 使用中文与用户对话
- 用户明确要求时才切换其他语言
- 代码注释, 文档编写等技术内容遵循项目默认的语言规范

## 文件删除规则
- 禁止使用 `rm` 命令删除文件和文件夹
- 应使用 MacOS 废纸篓功能来移除文件
- 使用 `trash` 命令代替 `rm`
```bash
trash filename   # 代替 rm filename
trash -r dirname # 代替 rm -rf dirname
```

## 文字规则
- 任何代码和文档都严禁使用 emoji

## Markdown 文档规则

- 严禁使用中日文全角标点, 必须使用英文半角标点, 并确保标点前后有适当的空格
- 严禁使用粗体(`**`)强调
- 使用 `@agent-md-doc` 进行 Markdown 文档的创建, 修改, 检查(review)和改进

## 高效工具使用规则

### 核心原则
一个命令行操作 > 多次工具调用

### 必备命令

#### 模式搜索
```bash
rg -n "pattern" --glob '!vendor/*'  # 带行号搜索, 排除vendor目录
```

#### 文件查找
```bash
fd filename          # 按名称查找
fd .ext directory    # 按扩展名在指定目录查找
```

#### 批量重构
```bash
# 查找并批量替换 - 一个命令替代几十次 Edit 调用!
rg -l "pattern" | xargs sed -i '' 's/old/new/g'
```

#### 项目结构
```bash
tree -L 2            # 快速查看项目结构
```

#### 数据处理
```bash
jq '.key' file.json  # 直接提取 JSON 数据
yq '.key' file.yaml  # 直接提取 YAML 数据
```

### 高效模式

#### 关键模式: 查找 → 管道 → 批量转换
```bash
# 这一个命令可以替代几十次 Edit 工具调用!
rg -l "find_this" | xargs sed -i '' 's/replace_this/with_this/g'
```

### 工作流程检查清单
使用 `Read`/`Edit`/`Glob` 工具前, 先考虑:
- 能用 `rg` 更快找到这个模式吗?
- 能用 `fd` 更快定位这些文件吗?
- 能用 `sed` 一次修复所有实例吗?
- 能用 `jq`/`yq` 直接提取数据吗?

### 实用组合
```bash
# 查找 Go 结构体定义
rg "type\s+\w+\s+struct" -t go

# 查找 Go 函数定义
rg "func\s+\w+" -t go

# 批量重命名
fd old_pattern | xargs -I {} mv {} {//}/new_name

# 统计 Go 代码行数
fd -e go | xargs wc -l
```

### 规则
- 优先使用 CLI 命令, 避免多次工具调用
- 批量操作必须使用管道和 `xargs`
- 搜索前用专业工具快速定位
- 记住: 一个好的管道命令 > 几十次 API 调用

## 开发指南

### 开发理念
- 小步快跑: 逐步提交, 可编译, 可测试
- 先学后做: 研究现有代码再实现
- 务实优先: 贴合项目实际, 不盲目追求模式
- 清晰胜过巧妙: 代码要直白易懂

### 简单原则
- 单一职责
- 避免过早抽象
- 不要花哨技巧
- 复杂到需要解释, 就该简化
- 命名易懂, 意思自明

### 实现流程
- 理解: 研究现有模式
- 计划: 做出设计/实现计划, 让用户 review
- 实现: 最小代码实现功能
- 重构: 清理代码
- 提交: 信息清楚, 关联计划

### 卡住时 (最多 2 次尝试)
- 记录失败原因和错误
- 调研 2~3 个替代方案
- 反思是否能更简单/更细化
- 换个角度尝试(库, 架构, 去掉抽象)
- 向用户求助求教

### 测试
- 优先使用项目已有的测试框架
- 测行为, 不测实现
- 名称清晰描述场景
- 可重复, 保持测试独立性, 尽可能让测试可以并发执行

### 技术规范
- 架构: 组合优先, 接口优先, 显式优于隐式
- 代码质量: 提交必须编译通过, 符合格式规范
- 错误处理: 快速失败, 报明确信息, 不要吞掉异常

### 决策优先级
1. 可读
2. 一致
3. 简单
4. 易改

### 项目规则
- 学习并遵循现有模式和库
- 不轻易引入新工具
- 使用项目已有的构建, 测试, 格式化工具

### 完成标准
- 无编译错误
- 无 `lint` 警告
- 测试通过
- 用户 review 完毕
